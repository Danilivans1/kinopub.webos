{"version":3,"sources":["components/text/text.tsx","hooks/useApi.ts","components/button/button.tsx","views/settings/settings.tsx"],"names":["Text","styled","BodyText","useApi","method","params","options","client","useMemo","ApiClient","query","useQuery","Wrapper","div","StyledButton","EnactButton","ButtonInner","Icon","props","iconOnly","Button","icon","children","autoFocus","wrapperRef","useRef","useEffect","frameId","requestAnimationFrame","current","querySelector","focus","cancelAnimationFrame","ref","name","Content","Settings","Setting","Footer","User","Device","SettingBool","setting","onToggle","defaultSelected","value","Bool","True","label","SettingList","onSelect","findIndex","selected","title","select","closeOnSelect","map","description","SettingsView","data","deviceInfo","saveDeviceSettingsAsync","useApiMutation","deactivate","useState","newSettings","setNewSettings","useDeviceInfo","software","hardware","boolSettings","filter","device","settings","key","listSettings","handleBoolSettingToggle","useCallback","a","handleListSettingSelect","id","handleSaveClick","window","location","reload","handleLogoutClick","updated","onClick","user","profile","username","Math","floor","subscription","days"],"mappings":"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","file":"static/js/27.7c3d701a.chunk.js","sourcesContent":["import BodyText from '@enact/moonstone/BodyText';\nimport styled from 'styled-components';\n\nconst Text = styled(BodyText)``;\n\nexport default Text;\n","import { useMemo } from 'react';\nimport { UseQueryOptions, useQuery } from 'react-query';\n\nimport ApiClient from 'api';\n\ntype Unpromise<T> = T extends Promise<infer U> ? U : T;\n\nexport type Methods = {\n  [method in keyof ApiClient]: ApiClient[method] extends Function ? Unpromise<ReturnType<ApiClient[method]>> : never;\n};\n\nexport type Method = keyof ApiClient & string;\n\nfunction useApi<T extends Method>(\n  method: T,\n  params: Parameters<ApiClient[T]> = [] as Parameters<ApiClient[T]>,\n  options?: UseQueryOptions<Methods[T]>,\n) {\n  const client = useMemo(() => new ApiClient(), []);\n  const query = useQuery<Methods[T]>(\n    [method, ...params],\n    () =>\n      // @ts-expect-error\n      client[method](...params) as Methods[T],\n    options,\n  );\n\n  return query;\n}\n\nexport default useApi;\n","import { useEffect, useRef } from 'react';\nimport EnactButton, { ButtonProps } from '@enact/moonstone/Button';\nimport styled from 'styled-components';\n\nimport Icon from 'components/icon';\n\nconst Wrapper = styled.div`\n  display: inline-flex;\n\n  > div {\n    width: 100%;\n  }\n`;\n\nconst StyledButton = styled(EnactButton)`\n  color: inherit;\n  text-decoration: none;\n`;\n\nconst ButtonInner = styled.div<{ iconOnly?: boolean }>`\n  display: flex;\n  align-items: center;\n  color: inherit;\n  text-decoration: none;\n\n  ${Icon} {\n    margin-right: ${(props) => !props.iconOnly && '0.5rem'};\n  }\n`;\n\ntype Props = {\n  icon?: string;\n  iconOnly?: boolean;\n  autoFocus?: boolean;\n  onClick?: React.MouseEventHandler;\n} & ButtonProps;\n\nconst Button: React.FC<Props> = ({ icon, iconOnly, children, autoFocus, ...props }) => {\n  const wrapperRef = useRef<HTMLDivElement | null>(null);\n\n  useEffect(() => {\n    let frameId: number;\n\n    if (autoFocus) {\n      frameId = requestAnimationFrame(() => {\n        wrapperRef.current?.querySelector<HTMLDivElement>('[role=\"button\"]')?.focus();\n      });\n    }\n\n    return () => {\n      if (frameId) {\n        cancelAnimationFrame(frameId);\n      }\n    };\n  }, [wrapperRef, autoFocus]);\n\n  return (\n    <Wrapper ref={wrapperRef}>\n      <StyledButton {...props}>\n        <ButtonInner iconOnly={iconOnly}>\n          {icon && <Icon name={icon} />}\n          {!iconOnly && children}\n        </ButtonInner>\n      </StyledButton>\n    </Wrapper>\n  );\n};\n\nexport default Button;\n","import React, { useCallback, useMemo, useState } from 'react';\nimport CheckboxItem from '@enact/moonstone/CheckboxItem';\nimport ExpandableList from '@enact/moonstone/ExpandableList';\nimport filter from 'lodash/filter';\nimport findIndex from 'lodash/findIndex';\nimport map from 'lodash/map';\nimport styled from 'styled-components';\n\nimport { Bool, DeviceSettingBoolean, DeviceSettingList, DeviceSettingsParams } from 'api';\nimport Button from 'components/button';\nimport Text from 'components/text';\nimport useApi from 'hooks/useApi';\nimport useApiMutation from 'hooks/useApiMutation';\nimport useDeviceInfo from 'hooks/useDeviceInfo';\n\nconst Content = styled.div`\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n`;\n\nconst Settings = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n  padding-bottom: 2rem;\n`;\n\nconst Setting = styled.div`\n  flex-basis: 50%;\n  box-sizing: border-box;\n  padding-right: 1rem;\n`;\n\nconst Footer = styled.div`\n  display: flex;\n  justify-content: space-between;\n`;\n\nconst User = styled.div`\n  display: flex;\n  align-items: center;\n\n  ${Text} {\n    padding-right: 2rem;\n  }\n`;\n\nconst Device = styled.div`\n  display: flex;\n  flex-basis: 50%;\n  padding-left: 1rem;\n  align-items: flex-end;\n`;\n\nconst SettingBool: React.FC<{ setting: DeviceSettingBoolean; onToggle?: Function }> = ({ setting, onToggle }) => {\n  return (\n    <CheckboxItem defaultSelected={setting.value === Bool.True} onToggle={onToggle}>\n      {setting.label}\n    </CheckboxItem>\n  );\n};\n\nconst SettingList: React.FC<{ setting: DeviceSettingList; onSelect?: Function }> = ({ setting, onSelect }) => {\n  return (\n    <ExpandableList\n      // @ts-expect-error\n      defaultSelected={findIndex(setting.value, (value) => value.selected === Bool.True)}\n      title={setting.label}\n      select=\"radio\"\n      onSelect={onSelect}\n      closeOnSelect\n    >\n      {map(setting.value, (value) => `${value.label} ${value.description ? `(${value.description})` : ''}`) as string[]}\n    </ExpandableList>\n  );\n};\n\nconst SettingsView: React.FC = () => {\n  const { data } = useApi('user');\n  const { data: deviceInfo } = useApi('deviceInfo');\n  const { saveDeviceSettingsAsync } = useApiMutation('saveDeviceSettings');\n  const { deactivate } = useApiMutation('deactivate');\n  const [newSettings, setNewSettings] = useState<DeviceSettingsParams>({});\n  const { software, hardware } = useDeviceInfo();\n\n  const boolSettings = useMemo(\n    () =>\n      filter(\n        map(deviceInfo?.device?.settings, (setting, key) => ({ ...setting, key })),\n        (setting: DeviceSettingBoolean) => typeof setting['type'] === 'undefined',\n      ) as (DeviceSettingBoolean & { key: string })[],\n    [deviceInfo?.device?.settings],\n  );\n  const listSettings = useMemo(\n    () =>\n      filter(\n        map(deviceInfo?.device?.settings, (setting, key) => ({ ...setting, key })),\n        (setting: DeviceSettingList) => setting['type'] === 'list',\n      ) as (DeviceSettingList & { key: string })[],\n    [deviceInfo?.device?.settings],\n  );\n\n  const handleBoolSettingToggle = useCallback(\n    (setting: typeof boolSettings[0]) =>\n      async ({ selected }: { selected: boolean }) => {\n        setNewSettings({ ...newSettings, [setting['key']]: selected });\n      },\n    [newSettings],\n  );\n  const handleListSettingSelect = useCallback(\n    (setting: typeof listSettings[0]) =>\n      ({ selected }: { selected: number }) => {\n        setNewSettings({ ...newSettings, [setting['key']]: setting.value[selected].id });\n      },\n    [newSettings],\n  );\n\n  const handleSaveClick = useCallback(async () => {\n    await saveDeviceSettingsAsync([deviceInfo?.device.id!, newSettings]);\n\n    window.location.reload();\n  }, [newSettings, deviceInfo?.device, saveDeviceSettingsAsync]);\n  const handleLogoutClick = useCallback(() => {\n    deactivate([]);\n  }, [deactivate]);\n\n  return (\n    <>\n      <Text>Настройки устройства</Text>\n\n      <Content>\n        {deviceInfo?.device && (\n          <>\n            <div>\n              <Settings key={`bool-${deviceInfo?.device.updated}`}>\n                {map(boolSettings, (setting) => (\n                  <Setting key={setting['key']}>\n                    <SettingBool setting={setting} onToggle={handleBoolSettingToggle(setting)} />\n                  </Setting>\n                ))}\n              </Settings>\n              <Settings key={`list-${deviceInfo?.device.updated}`}>\n                {map(listSettings, (setting) => (\n                  <Setting key={setting['key']}>\n                    <SettingList setting={setting} onSelect={handleListSettingSelect(setting)} />\n                  </Setting>\n                ))}\n              </Settings>\n            </div>\n\n            <div>\n              <Button icon=\"done\" onClick={handleSaveClick}>\n                Сохранить\n              </Button>\n            </div>\n          </>\n        )}\n\n        <Footer>\n          <div>\n            <Text>Пользователь</Text>\n            <User>\n              {data?.user && (\n                <Text>\n                  {data.user.profile.name || data.user.username} ({Math.floor(data.user.subscription.days)} дн.)\n                </Text>\n              )}\n\n              <Button icon=\"logout\" onClick={handleLogoutClick}>\n                Выход\n              </Button>\n            </User>\n          </div>\n\n          <Device>\n            <Text>\n              <div>{hardware}</div>\n              <div>{software}</div>\n            </Text>\n          </Device>\n        </Footer>\n      </Content>\n    </>\n  );\n};\n\nexport default SettingsView;\n"],"sourceRoot":""}